<div class="navbar">
  <div class="navbar-left">
    <img src="assets/img/logo.png" alt="Filmosphere Logo" class="logo-img" />
    <h1 class="logo" routerLink="/home" style="cursor: pointer;">FILMOSPHERE</h1>
  </div>

  <!-- ðŸ” Search & Filter Films -->
  <div class="nav-link-wrapper">
    <a class="nav-link" routerLink="/film-search" routerLinkActive="active">
      <i class="pi pi-search"></i>
      <span>Search & Filter Films</span>
    </a>
  </div>

  <!-- ðŸ‘¥ Search Users -->
  <div class="nav-link-wrapper">
    <a class="nav-link" routerLink="/user-search" routerLinkActive="active">
      <i class="pi pi-users"></i>
      <span>Search Users</span>
    </a>
  </div>

  <!-- ðŸŽ¬ Recommendation Chat -->
  <div class="nav-link-wrapper">
    <a class="nav-link" routerLink="/recommendation-chat" routerLinkActive="active">
      <i class="pi pi-comments"></i>
      <span>Recommendation Chat</span>
    </a>
  </div>

  <!-- ðŸ‘¤ Profile / Avatar -->
  <div class="navbar-right profile-menu-trigger" (click)="profileMenu.toggle($event)">
    <p-avatar 
      *ngIf="avatarImage"
      [image]="avatarImage"
      shape="circle"
      style="width:50px; height:50px;">
    </p-avatar>

    <p-avatar 
      *ngIf="!avatarImage && avatarLabel"
      [label]="avatarLabel"
      shape="circle"
      style="background:#e50914; color:white; width:50px; height:50px; font-size:20px;">
    </p-avatar>

    <span class="username">{{ user?.username || 'Guest' }}</span>
    <i class="pi pi-chevron-down dropdown-arrow"></i>
  </div>
</div>

<p-popover 
  #profileMenu 
  appendTo="body" 
  [style]="{width: '230px', background: '#1a1a1a', border: '1px solid #333', borderRadius: '8px'}" 
  styleClass="profile-dropdown-panel"
>
  <p-menu [model]="menuItems"></p-menu>
</p-popover>

<div class="user-search-container">
  <div class="top-bar">
    <div class="search-wrapper">
      <h1 class="page-title">Search Users</h1>
      <div class="search-input-group">
        <input 
          type="text" 
          [(ngModel)]="searchQuery" 
          (input)="onSearchInputChange()"
          (keyup.enter)="searchUsers()"
          placeholder="Search by username..."
          class="search-input"
          pInputText
        />
        <p-button 
          label="Search" 
          icon="pi pi-search" 
          (click)="searchUsers()"
          [loading]="loading"
          styleClass="p-button-danger">
        </p-button>
      </div>
    </div>
  </div>

  <div class="results-section">
    <div *ngIf="loading" class="loading">Searching users...</div>
    
    <div *ngIf="!loading && users.length === 0 && searchQuery" class="empty-state">
      <i class="pi pi-user" style="font-size: 3rem; color: #666; margin-bottom: 1rem;"></i>
      <p>No users found matching "{{ searchQuery }}"</p>
    </div>

    <div *ngIf="!loading && searchQuery && users.length === 0" class="empty-state">
      <i class="pi pi-search" style="font-size: 3rem; color: #666; margin-bottom: 1rem;"></i>
      <p>Enter a username to search</p>
    </div>

    <div *ngIf="!loading && users.length > 0" class="users-grid">
      <div *ngFor="let user of users" class="user-card">
        <div class="user-card-content" (click)="goToProfile(user.username)">
          <p-avatar 
            *ngIf="user.profile_picture_url"
            [image]="user.profile_picture_url"
            shape="circle"
            size="xlarge"
            style="width:80px; height:80px;">
          </p-avatar>
          <p-avatar 
            *ngIf="!user.profile_picture_url"
            [label]="(user.username || 'U')[0]?.toUpperCase() || 'U'"
            shape="circle"
            size="xlarge"
            style="background:#e50914; color:white; width:80px; height:80px; font-size:32px;">
          </p-avatar>
          <h3>{{ user.username }}</h3>
          <p *ngIf="user.profile?.display_name" class="display-name">{{ user.profile.display_name }}</p>
          <div class="user-stats">
            <span><i class="pi pi-film"></i> {{ user.films_watched_count || 0 }} films</span>
            <span><i class="pi pi-star"></i> {{ user.reviews_count || 0 }} reviews</span>
          </div>
        </div>
        <div class="user-actions">
          <p-button 
            *ngIf="user.username && user.username !== (this.user?.username || this.user?.user?.username || '')"
            [label]="followStatuses[user.username] ? 'Unfollow' : 'Follow'"
            [icon]="followStatuses[user.username] ? 'pi pi-user-minus' : 'pi pi-user-plus'"
            [styleClass]="followStatuses[user.username] ? 'p-button-secondary' : 'p-button-danger'"
            (click)="toggleFollow(user.username); $event.stopPropagation()"
            styleClass="p-button-sm">
          </p-button>
        </div>
      </div>
    </div>
  </div>
</div>

